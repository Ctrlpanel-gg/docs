"use strict";(self.webpackChunkctrlpanel=self.webpackChunkctrlpanel||[]).push([[278],{4166:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"Guides/backups","title":"Database backups","description":"All important data is stored in the database. This includes all servers, users, and other sensitive information. It\'s important to keep backups of your database to ensure that you can restore your panel if something goes wrong.","source":"@site/versioned_docs/version-0.9.x/Guides/backups.md","sourceDirName":"Guides","slug":"/Guides/backups","permalink":"/docs/0.9.x/Guides/backups","draft":false,"unlisted":false,"editUrl":"https://github.com/Ctrlpanel-gg/docs/tree/main/versioned_docs/version-0.9.x/Guides/backups.md","tags":[],"version":"0.9.x","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Products","permalink":"/docs/0.9.x/Guides/products"},"next":{"title":"Adding Translation Files","permalink":"/docs/0.9.x/Guides/translation"}}');var o=a(4848),s=a(8453),r=a(4252);const i={sidebar_position:2},l="Database backups",c={},d=[{value:"How to back up",id:"how-to-back-up",level:3},{value:"How to restore",id:"how-to-restore",level:3},{value:"How to Backup Automatically",id:"how-to-backup-automatically",level:3},{value:"Appliaction key",id:"appliaction-key",level:2},{value:"Backup the application key",id:"backup-the-application-key",level:3},{value:"Restoring the application key",id:"restoring-the-application-key",level:3}];function u(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"database-backups",children:"Database backups"})}),"\n",(0,o.jsx)(n.p,{children:"All important data is stored in the database. This includes all servers, users, and other sensitive information. It's important to keep backups of your database to ensure that you can restore your panel if something goes wrong."}),"\n","\n",(0,o.jsx)(r.A,{toc:d}),"\n",(0,o.jsx)(n.h3,{id:"how-to-back-up",children:"How to back up"}),"\n",(0,o.jsxs)(n.p,{children:["You can use MySQL dump to back up your database.",(0,o.jsx)(n.br,{}),"\n","This command will create a backup file in the ",(0,o.jsx)(n.code,{children:"/var/www/controlpanel/"})," folder."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"mysqldump -u root -p controlpanel > /var/www/controlpanel/backup.sql\n"})}),"\n",(0,o.jsx)(n.h3,{id:"how-to-restore",children:"How to restore"}),"\n",(0,o.jsx)(n.p,{children:"To restore a backup, you need a fresh database. If you already have a database, you can use the following command to drop it."}),"\n",(0,o.jsxs)(n.admonition,{type:"warning",children:[(0,o.jsx)(n.p,{children:"Warning, this will delete all Controlpanel related data! Make sure your database is backed up or has nothing valuable before continuing."}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'mysql -u root -p controlpanel -e "DROP DATABASE controlpanel"\n'})})]}),"\n",(0,o.jsxs)(n.p,{children:["Once you make sure that there isn't a table called ",(0,o.jsx)(n.code,{children:"controlpanel"}),", you can continue with restoring your database by running the commands below."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"mysql -u root -p\nCREATE DATABASE controlpanel;\nCREATE USER 'controlpaneluser'@'127.0.0.1' IDENTIFIED BY 'USE_YOUR_OWN_PASSWORD';\nGRANT ALL PRIVILEGES ON controlpanel.* TO 'controlpaneluser'@'127.0.0.1';\nFLUSH PRIVILEGES;\nexit\nmysql -u root -p controlpanel < /var/www/controlpanel/backup.sql\n"})}),"\n",(0,o.jsx)(n.p,{children:"If you have a backup from an older version of Ctrlpanel, you have to migrate the database to the latest version by running the command below."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"cd /var/www/controlpanel\nsudo php artisan migrate --seed --force\n"})}),"\n",(0,o.jsx)(n.h3,{id:"how-to-backup-automatically",children:"How to Backup Automatically"}),"\n",(0,o.jsx)(n.p,{children:"Using crontab, you are able to allow backups created at a specific time, for example every midnight. But to first continue, you have to create a read-only account that can access the tables in MySQL/MariaDB. To do so, run the following commands."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"mkdir -p /var/www/controlpanel/backups\nmysql -u root -p\nCREATE USER 'controlpanelbackupuser'@'127.0.0.1' IDENTIFIED BY 'USE_YOUR_OWN_PASSWORD';\nGRANT LOCK TABLES, SELECT ON controlpanel.* TO 'controlpanelbackupuser'@'127.0.0.1';\nFLUSH PRIVILEGES;\nexit\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Once you've created a read-only MySQL/MariaDB user that can access the ",(0,o.jsx)(n.code,{children:"controlpanel"})," database, it's time to add it to the crontab to start the backup. For the purpose of this, we will be setting the time as every midnight however you are able to change it. If you're new to crontabs, we suggest using ",(0,o.jsx)(n.a,{href:"https://crontab.guru/",children:"crontab.guru"}),". Run ",(0,o.jsx)(n.code,{children:"crontab -e"})," and add the following line:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"0 0 * * * mysqldump -u controlpanelbackupuser --password=<USE_YOUR_OWN_PASSWORD> --single-transaction --quick --lock-tables=false controlpanel > /var/www/controlpanel/backups-$(date +\\%F).sql\n"})}),"\n",(0,o.jsxs)(n.p,{children:["This will create a backup at /var/www/controlpanel/backups-$(date +%F).sql every day at midnight. The ",(0,o.jsx)(n.code,{children:"$(date +\\%F)"})," will be replaced with the date.\nThis is done to ensure that if you encounter a issue you know the date of your databases and restore them with ease."]}),"\n",(0,o.jsx)(n.h2,{id:"appliaction-key",children:"Appliaction key"}),"\n",(0,o.jsx)(n.p,{children:"The application key is used to encrypt the data in the database and if it's lost, you will not be able to decrypt the data in the database meaning it will become useless."}),"\n",(0,o.jsx)(n.h3,{id:"backup-the-application-key",children:"Backup the application key"}),"\n",(0,o.jsxs)(n.p,{children:["To backup the appliaction key you need to get it from the ",(0,o.jsx)(n.code,{children:".env"})," file.\nYou can find this file by running the following command:"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.code,{children:"nano /var/www/controlpanel/.env"})}),"\n",(0,o.jsx)(n.p,{children:"You want to ensure you have a copy of it somewhere so in case you need the key, you can find it and easily restore the database without any issues."}),"\n",(0,o.jsx)(n.h3,{id:"restoring-the-application-key",children:"Restoring the application key"}),"\n",(0,o.jsxs)(n.p,{children:["Once you have your dashboard reinstalled, run this command to open the .env and replace the ",(0,o.jsx)(n.code,{children:"APP_KEY"})," section:\n",(0,o.jsx)(n.code,{children:"nano /var/www/controlpanel/.env"})]}),"\n",(0,o.jsxs)(n.p,{children:["Once done, you should not encounter any issues. If you do however, we'll be waiting for you in our ",(0,o.jsx)(n.a,{href:"https://discord.gg/4Y6HjD2uyU",children:"Discord"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}},4252:(e,n,a)=>{a.d(n,{A:()=>r});a(6540);var t=a(5195);const o={tableOfContentsInline:"tableOfContentsInline_prmo"};var s=a(4848);function r({toc:e,minHeadingLevel:n,maxHeadingLevel:a}){return(0,s.jsx)("div",{className:o.tableOfContentsInline,children:(0,s.jsx)(t.A,{toc:e,minHeadingLevel:n,maxHeadingLevel:a,className:"table-of-contents",linkClassName:null})})}},5195:(e,n,a)=>{a.d(n,{A:()=>b});var t=a(6540),o=a(6342);function s(e){const n=e.map(e=>({...e,parentIndex:-1,children:[]})),a=Array(7).fill(-1);n.forEach((e,n)=>{const t=a.slice(2,e.level);e.parentIndex=Math.max(...t),a[e.level]=n});const t=[];return n.forEach(e=>{const{parentIndex:a,...o}=e;a>=0?n[a].children.push(o):t.push(o)}),t}function r({toc:e,minHeadingLevel:n,maxHeadingLevel:a}){return e.flatMap(e=>{const t=r({toc:e.children,minHeadingLevel:n,maxHeadingLevel:a});return function(e){return e.level>=n&&e.level<=a}(e)?[{...e,children:t}]:t})}function i(e){const n=e.getBoundingClientRect();return n.top===n.bottom?i(e.parentNode):n}function l(e,{anchorTopOffset:n}){const a=e.find(e=>i(e).top>=n);if(a){return function(e){return e.top>0&&e.bottom<window.innerHeight/2}(i(a))?a:e[e.indexOf(a)-1]??null}return e[e.length-1]??null}function c(){const e=(0,t.useRef)(0),{navbar:{hideOnScroll:n}}=(0,o.p)();return(0,t.useEffect)(()=>{e.current=n?0:document.querySelector(".navbar").clientHeight},[n]),e}function d(e){const n=(0,t.useRef)(void 0),a=c();(0,t.useEffect)(()=>{if(!e)return()=>{};const{linkClassName:t,linkActiveClassName:o,minHeadingLevel:s,maxHeadingLevel:r}=e;function i(){const e=function(e){return Array.from(document.getElementsByClassName(e))}(t),i=function({minHeadingLevel:e,maxHeadingLevel:n}){const a=[];for(let t=e;t<=n;t+=1)a.push(`h${t}.anchor`);return Array.from(document.querySelectorAll(a.join()))}({minHeadingLevel:s,maxHeadingLevel:r}),c=l(i,{anchorTopOffset:a.current}),d=e.find(e=>c&&c.id===function(e){return decodeURIComponent(e.href.substring(e.href.indexOf("#")+1))}(e));e.forEach(e=>{!function(e,a){a?(n.current&&n.current!==e&&n.current.classList.remove(o),e.classList.add(o),n.current=e):e.classList.remove(o)}(e,e===d)})}return document.addEventListener("scroll",i),document.addEventListener("resize",i),i(),()=>{document.removeEventListener("scroll",i),document.removeEventListener("resize",i)}},[e,a])}var u=a(8774),h=a(4848);function p({toc:e,className:n,linkClassName:a,isChild:t}){return e.length?(0,h.jsx)("ul",{className:t?void 0:n,children:e.map(e=>(0,h.jsxs)("li",{children:[(0,h.jsx)(u.A,{to:`#${e.id}`,className:a??void 0,dangerouslySetInnerHTML:{__html:e.value}}),(0,h.jsx)(p,{isChild:!0,toc:e.children,className:n,linkClassName:a})]},e.id))}):null}const m=t.memo(p);function b({toc:e,className:n="table-of-contents table-of-contents__left-border",linkClassName:a="table-of-contents__link",linkActiveClassName:i,minHeadingLevel:l,maxHeadingLevel:c,...u}){const p=(0,o.p)(),b=l??p.tableOfContents.minHeadingLevel,f=c??p.tableOfContents.maxHeadingLevel,v=function({toc:e,minHeadingLevel:n,maxHeadingLevel:a}){return(0,t.useMemo)(()=>r({toc:s(e),minHeadingLevel:n,maxHeadingLevel:a}),[e,n,a])}({toc:e,minHeadingLevel:b,maxHeadingLevel:f});return d((0,t.useMemo)(()=>{if(a&&i)return{linkClassName:a,linkActiveClassName:i,minHeadingLevel:b,maxHeadingLevel:f}},[a,i,b,f])),(0,h.jsx)(m,{toc:v,className:n,linkClassName:a,...u})}},8453:(e,n,a)=>{a.d(n,{R:()=>r,x:()=>i});var t=a(6540);const o={},s=t.createContext(o);function r(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);